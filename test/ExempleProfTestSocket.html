<!DOCTYPE html>
<html lang="fr">
  <head>
      <script src="/socket.io/socket.io.js"></script>
      <script> var socket = io(); </script>
      <script>
         var numJoueur = -1;

         function demandeJoueurs() {
            console.log('Demande des joueurs');
            socket.emit('joueurs');
         }
         socket.on('joueurs', nomsJoueurs => {
            console.log(`Noms des joueurs reçus du serveur : ${nomJoueurs}`);
            listeJoueurs.value = nomsJoueurs;
         });

         function entrerDansLaPartie() {
            let nom = nomJ.value;
            console.log("Entrée de "+nom);
            if (nom != "" && nom != " ") socket.emit('entree', nom);
         }
         socket.on('entree', data => {
            console.log("Le serveur confirme mon entrée avec numJoueur="+data.numJoueur);
            numJoueur = data.numJoueur;
            btentree.disabled = true;
            btsortie.disabled = false;
            listeJoueurs.textContent = data.nomsJoueurs;
            numJ.textContent = data.numJoueur;
         });
         socket.on('entreeAutreJoueur', data => {
            console.log("Le serveur confirme l'entrée de "+data.nomJoueur);
            listeJoueurs.textContent = data.nomsJoueurs;
         });

         function quitterLaPartie() {
            let nom = nomJ.value;
            console.log("Sortie de "+nom);
            if (nom != "" && nom != " ") socket.emit('sortie', nom);
         }
         socket.on('sortie', data => {
            console.log("Le serveur confirme ma sortie");
            //console.dir(data);
            numJoueur = -1;
            nomJ.value = "";
            numJ.textContent = "";
            btentree.disabled = false;
            btsortie.disabled = true;
            listeJoueurs.textContent = data.nomsJoueurs;
            messageServeur.textConteent = "";
         });
         socket.on('sortieAutreJoueur', data => {
            console.log(`Le serveur confirme la sortie de $(data.nomJoueur) de numéro $(data.numJoueur)`);   
            if (numJoueur > data.numJoueur) {
               numJoueur--;
               numJ.textContent = numJoueur;
            }
            listeJoueurs.textContent = data.nomsJoueurs;
            $("#messageServeur").text("");
         });

         function envoiMessage(input) {
            console.log("Envoi du message :", input.value)
            socket.emit("message", {'numJoueur':numJoueur, 'texte':input.value});
         }
         socket.on('message', message => { 
            console.log("Réception du message :", message);
            messages.value = messages.value+'\n'+message;
            messages2.value += message + "<br>"
            message.value = "";
         });

         socket.on('messageServeur', message => {
            console.log("Message serveur :", message);
            messageServeur.textContent = message;
         });
      </script>
  </head>
  <body>
      <div id ="joueurs">
         Joueurs : <label id="listeJoueurs"></label> <br/>
         Votre nom <input id="nomJ" type="text" /> Votre numéro : <label id="numJ"></label>
         <button type="button" id="btentree" onClick="entrerDansLaPartie()">
            Entrer dans la partie </button>
         <button type="button" id="btsortie" disabled onClick="quitterLaPartie()">
            Quitter la partie </button> <br/>
      </div>
      <hr/>
      Message du serveur : <label id="messageServeur"></label>
      <hr/>
      Votre message <input id="message" type="text" onChange="envoiMessage(this)"/> <br/>
      <textarea id="messages" rows="20" cols="75"></textarea>
      <div id="messages2" style="
    width: 300px;
    height: 200px;
    border: 1px solid #aaa;
    overflow-y: auto;
    padding: 5px;
"></div>
  </body>
</html>
